%script(type='text/ng-template' id="habits/edit")
  .nav-bar
    %a.habits-link.fa.fa-bars(ui-sref="app.habits" ui-sref-opts="{reload: true}")
    %h4 Edit Habit
  .habits-edit
    .habit-form
      %alert(close="closeFlash()" ng-show="errors.length > 0" type="danger")
        %ul
          %li.error(ng-repeat="error in errors") {{error}}
      %form
        .section
          .form-group(ng-class="titleErrors ? 'has-error' : ''")
            %input.form-control(name="title" ng-focus="onFocus($event)" ng-model="habit.title" placeholder="habit title" type="text" empty-typeahead typeahead="suggestion as suggestion.title for suggestion in suggestions($viewValue) | filter:$viewValue:comparator" typeahead-on-select="onSelect($item, $model, $label)" typeahead-template-url="typeahead")/
      .section
        .form-group(ng-class="valueErrors ? 'has-error' : ''")
          %label Target
          %input.form-control(name="target-value" ng-model="target.value" placeholder="value")/
        .form-group(ng-class="unitErrors ? 'has-error' : ''")
          %input#unit.form-control(name="unit" ng-model="target.unit" placeholder="unit")/
        .unit-conversion-form
          Convert or Archive?
          .form-group
            %label Conversion Type
            %select#conversion-type.form-control(ng-model="conversion.type")
              %option *
              %option /
          .form-group
            %label Conversion factor
            %input#conversion-factor.form-control(ng-model="conversion.factor" name="conversionFactor" type="number")/
          Last check in: {{habit.last_checkin_value}} {{target.originalUnit}} {{conversion.type}} {{conversion.factor}} = {{ conversionResult()}} {{target.unit}}
        .form-group
          %select(name="target-timeframe" ng-model="target.timeframe" ng-options="timeframe for timeframe in timeFrameOptions")
      .section
        .form-group
          %label Private
          %input#private(ng-model="habit.private" type="checkbox")/
      .section
        %button.save.btn.btn-primary(ng-click="save()") Save
        %button.cancel.btn.btn-link(ng-click="cancel()" ng-if="!isEditable") Cancel
    .padded-container
      %button.abandon.btn.btn-danger(ng-click="deleteHabit(habit)" ng-if="habit.user_count > 1") Abandon {{habit.title}}
      %button.delete.btn.btn-danger(ng-click="deleteHabit(habit)" ng-if="habit.user_count == 1") Delete {{habit.title}}
